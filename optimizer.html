<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Decision Optimizer - Evonik Methionine Production</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="shared-styles.css">
    <style>
        /* Page-specific styles for optimizer.html */
        .header {
            background: linear-gradient(135deg, var(--evonik-purple) 0%, var(--evonik-dark-purple) 100%);
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1600px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .ai-badge {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .role-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .role-selector label {
            font-size: 0.9rem;
        }

        .role-selector select {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            background: white;
            color: var(--evonik-purple);
            font-weight: 500;
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: background 0.3s;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
        }

        .container {
            display: flex;
            height: calc(100vh - 140px);
            max-width: 1600px;
            margin: 0 auto;
            gap: 1rem;
            padding: 1rem;
        }

        /* Chat Panel - Left */
        .chat-panel {
            width: 40%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: var(--evonik-purple);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .message.system .message-avatar {
            background: linear-gradient(135deg, var(--evonik-purple), var(--evonik-light-purple));
            color: white;
        }

        .message.user .message-avatar {
            background: var(--border-gray);
            color: var(--text-dark);
        }

        .message-bubble {
            max-width: 75%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            line-height: 1.5;
        }

        .message.system .message-bubble {
            background: var(--bg-gray);
            color: var(--text-dark);
            border: 1px solid var(--border-gray);
        }

        .message.user .message-bubble {
            background: var(--evonik-purple);
            color: white;
        }

        .message.alert .message-bubble {
            background: #FEF2F2;
            border: 2px solid var(--alert-red);
            color: var(--alert-red);
            font-weight: 500;
        }

        .typing-indicator {
            display: flex;
            gap: 0.25rem;
            padding: 0.5rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-light);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }

        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid var(--border-gray);
            background: white;
        }

        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            padding: 0.4rem 0.8rem;
            background: var(--bg-gray);
            border: 1px solid var(--border-gray);
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-action-btn:hover {
            background: var(--evonik-light-purple);
            color: white;
            border-color: var(--evonik-light-purple);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--border-gray);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--evonik-purple);
        }

        .send-btn {
            padding: 0.75rem 1.5rem;
            background: var(--evonik-purple);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        .send-btn:hover {
            background: var(--evonik-dark-purple);
        }

        .send-btn:disabled {
            background: var(--border-gray);
            cursor: not-allowed;
        }

        /* Visualization Panel - Right */
        .viz-panel {
            width: 60%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .viz-header {
            padding: 1rem 1.5rem;
            border-bottom: 2px solid var(--border-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .viz-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .viz-timestamp {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .viz-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .viz-placeholder {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            text-align: center;
        }

        .viz-placeholder-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .chart-container {
            height: 400px;
            margin-bottom: 2rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: var(--bg-gray);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-gray);
        }

        .metric-change {
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }

        .metric-change.positive { color: var(--success-green); }
        .metric-change.negative { color: var(--alert-red); }

        .scenario-card {
            background: var(--bg-gray);
            border: 2px solid var(--border-gray);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            animation: fadeIn 0.5s ease;
        }

        .scenario-card.recommended {
            border-color: var(--success-green);
            background: linear-gradient(to right, rgba(22, 163, 74, 0.05), var(--bg-gray));
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .scenario-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .scenario-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-recommended {
            background: var(--success-green);
            color: white;
        }

        .scenario-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .scenario-metric {
            text-align: center;
        }

        .scenario-metric-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 0.25rem;
        }

        .scenario-metric-value {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .value-positive { color: var(--success-green); }
        .value-negative { color: var(--alert-red); }
        .value-neutral { color: var(--text-dark); }

        .explainability-panel {
            background: linear-gradient(to right, rgba(139, 46, 139, 0.05), white);
            border-left: 4px solid var(--evonik-purple);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .explainability-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--evonik-purple);
            margin-bottom: 1rem;
        }

        .explainability-reasons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .reason-item {
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
        }

        .reason-icon {
            width: 24px;
            height: 24px;
            background: var(--evonik-purple);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .reason-text {
            flex: 1;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-title">
                <h1>AI Decision Optimizer</h1>
                <div class="ai-badge">
                    <span>🤖</span>
                    <span>Layer 3: Intelligent Decision Engine</span>
                </div>
            </div>
            <div class="role-selector">
                <label>View as:</label>
                <select id="roleSelector" onchange="switchRole()">
                    <option value="local_sc">Local Supply Chain Manager</option>
                    <option value="plant">Plant Manager</option>
                    <option value="sales">Sales Team</option>
                    <option value="global_sc">Global Supply Chain</option>
                </select>
            </div>
            <div class="scenario-selector" style="margin-left: 2rem;">
                <label>Scenario Type:</label>
                <select id="scenarioSelector" onchange="switchScenario()">
                    <option value="equipment_failure">Equipment Failure</option>
                    <option value="supply_delay">Supply Delay</option>
                </select>
            </div>
        </div>
        <div class="nav-links">
            <a href="index.html" class="nav-link">← Coordination Dashboard</a>
            <a href="local-supply-chain.html" class="nav-link">Local Supply Chain</a>
            <a href="production.html" class="nav-link">Production</a>
            <a href="sales.html" class="nav-link">Sales</a>
        </div>
    </div>

    <div class="container">
        <!-- Chat Panel -->
        <div class="chat-panel">
            <div class="chat-header">
                <h2>Conversational AI Assistant</h2>
                <div class="chat-status">
                    <div class="status-dot"></div>
                    <span>Online</span>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <!-- Messages will be added here dynamically -->
            </div>

            <div class="chat-input-container">
                <div class="quick-actions" id="quickActions">
                    <button class="quick-action-btn" onclick="sendQuickMessage('Show current production status')">📊 Production Status</button>
                    <button class="quick-action-btn" onclick="sendQuickMessage('What are my tank levels?')">🛢️ Tank Levels</button>
                    <button class="quick-action-btn" onclick="sendQuickMessage('Show production costs')">💰 Cost Analysis</button>
                    <button class="quick-action-btn" onclick="triggerCrisis('equipment_failure')" style="background: #FEF2F2; border-color: #DC2626; color: #DC2626;">⚠️ Equipment Failure</button>
                    <button class="quick-action-btn" onclick="triggerCrisis('supply_delay')" style="background: #FEF2F2; border-color: #DC2626; color: #DC2626;">🚚 Supply Delay</button>
                </div>
                <div class="chat-input-wrapper">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything about your production planning..." onkeypress="handleKeyPress(event)">
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>

        <!-- Visualization Panel -->
        <div class="viz-panel">
            <div class="viz-header">
                <div class="viz-title" id="vizTitle">Production Overview</div>
                <div class="viz-timestamp" id="vizTimestamp">Live Data</div>
            </div>
            <div class="viz-content" id="vizContent">
                <div class="viz-placeholder">
                    <div class="viz-placeholder-icon">📊</div>
                    <h3>Ask me a question to get started</h3>
                    <p>I can show you production metrics, tank levels, cost analysis, and optimization scenarios</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentRole = 'local_sc';
        let conversationState = 'initial';
        let messageCount = 0;
        let crisisTriggered = false;
        let currentScenarioType = 'equipment_failure'; // 'equipment_failure' or 'supply_delay'

        // Role-specific contexts
        const roleContexts = {
            local_sc: {
                name: 'Local SC Manager',
                focus: 'inventory management, raw materials, SAP-Excel automation',
                greeting: 'Hello! I can help you with production planning, inventory optimization, and raw material coordination.'
            },
            plant: {
                name: 'Plant Manager',
                focus: 'equipment status, maintenance schedules, capacity utilization',
                greeting: 'Hello! I can help you with production capacity, equipment performance, and maintenance planning.'
            },
            sales: {
                name: 'Sales Team',
                focus: 'order fulfillment, customer impact, shipment planning',
                greeting: 'Hello! I can help you with order fulfillment forecasts, customer allocation, and demand planning.'
            },
            global_sc: {
                name: 'Global Supply Chain',
                focus: 'cross-plant coordination, global inventory, strategic allocation',
                greeting: 'Hello! I can help you with global coordination, multi-site optimization, and strategic planning.'
            }
        };

        // Scenario-specific data models
        const scenarioData = {
            equipment_failure: {
                name: "Equipment Failure",
                description: "ME6 unit offline - OAS sensor detection",
                impact: {
                    productionReduction: 345, // MT/day
                    downtime: "3-5 days",
                    totalShortfall: "1,035-1,725 MT",
                    affectedUnit: "ME6",
                    detectionTime: "Oct 23, 2025 14:23"
                },
                scenarios: [
                    {
                        id: "A",
                        title: "Increase ME5 Production",
                        description: "Increase ME5 unit capacity by 20% to compensate for ME6 shutdown",
                        costImpact: -25000,
                        timeline: "Immediate",
                        riskLevel: "Low",
                        details: {
                            increasedUtilities: 95000,
                            avoidedShortagePenalty: -120000,
                            netSavings: 25000
                        }
                    },
                    {
                        id: "B", 
                        title: "Divert to Malaysia Plant",
                        description: "Transfer production allocation to Malaysia facility",
                        costImpact: 60000,
                        timeline: "3 days",
                        riskLevel: "Medium",
                        details: {
                            transferLogistics: 180000,
                            avoidedShortagePenalty: -120000,
                            netCost: 60000
                        }
                    },
                    {
                        id: "C",
                        title: "Defer Customer Shipments", 
                        description: "Negotiate shipment delays with customers using tank inventory buffer",
                        costImpact: -30000,
                        timeline: "2 days",
                        riskLevel: "High",
                        details: {
                            demurrageFees: 90000,
                            avoidedShortagePenalty: -120000,
                            netSavings: 30000,
                            customerRisk: true
                        }
                    }
                ]
            },
            supply_delay: {
                name: "Supply Delay",
                description: "Critical raw material delivery delayed - H2 supply disruption",
                impact: {
                    productionReduction: 200, // MT/day
                    downtime: "2-4 days", 
                    totalShortfall: "400-800 MT",
                    affectedMaterial: "H2 (Hydrogen)",
                    detectionTime: "Oct 23, 2025 11:15"
                },
                scenarios: [
                    {
                        id: "A",
                        title: "Activate Emergency H2 Reserves",
                        description: "Use emergency hydrogen reserves and expedite alternative supplier",
                        costImpact: -15000,
                        timeline: "Immediate",
                        riskLevel: "Low",
                        details: {
                            emergencyReserveCost: 25000,
                            expeditedSupplier: 40000,
                            avoidedShortagePenalty: -80000,
                            netSavings: 15000
                        }
                    },
                    {
                        id: "B",
                        title: "Reduce Production Rate",
                        description: "Temporarily reduce ME5/ME6 production to 80% capacity",
                        costImpact: 35000,
                        timeline: "Immediate", 
                        riskLevel: "Medium",
                        details: {
                            productionLoss: 115000,
                            avoidedShortagePenalty: -80000,
                            netCost: 35000
                        }
                    },
                    {
                        id: "C",
                        title: "Switch to Alternative Feedstock",
                        description: "Temporarily use alternative H2 source with quality adjustments",
                        costImpact: 50000,
                        timeline: "1 day",
                        riskLevel: "High",
                        details: {
                            alternativeFeedstock: 130000,
                            avoidedShortagePenalty: -80000,
                            netCost: 50000,
                            qualityRisk: true
                        }
                    }
                ]
            }
        };

        // Current operational data (aligned with other dashboards)
        const operationalData = {
            production: {
                monthlyTarget: 29000,
                currentProduction: 22620,
                dailyOutput: 965,
                me5Output: 620,
                me6Output: 345,
                me5MaxCapacity: 775,
                me6MaxCapacity: 430
            },
            inventory: {
                tankLevel: 4200,
                tankCapacity: 6300,
                safeRange: { min: 3000, max: 6000 },
                mitsuiAllocation: 600,
                akemaAllocation: 0,
                heelStock: 836
            },
            costs: {
                dailyCost: 78.5,
                monthlyActual: 2.3,
                monthlyBudget: 2.4,
                costPerMT: 102
            },
            rawMaterials: {
                h2: { stock: 4800, consumption: 85, leadTime: 14 },
                mmp: { stock: 1850, consumption: 42, leadTime: 21 },
                methanol: { stock: 980, consumption: 38, leadTime: 18 }
            }
        };

        // Initialize chat
        function initChat() {
            const greeting = roleContexts[currentRole].greeting;
            addSystemMessage(greeting);
            addSystemMessage('Current SAP sync: Active, last sync 2 min ago. I have access to real-time data from SAP, OAS, and IBP systems. What would you like to know?');
        }

        // Add message functions
        function addSystemMessage(text, isAlert = false) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message system ${isAlert ? 'alert' : ''}`;
            messageDiv.innerHTML = `
                <div class="message-avatar">🤖</div>
                <div class="message-bubble">${text}</div>
            `;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function addUserMessage(text) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                <div class="message-avatar">👤</div>
                <div class="message-bubble">${text}</div>
            `;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesDiv = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message system';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">🤖</div>
                <div class="message-bubble">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            messagesDiv.appendChild(typingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function removeTypingIndicator() {
            const typing = document.getElementById('typingIndicator');
            if (typing) typing.remove();
        }

        // Handle user input
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addUserMessage(message);
            input.value = '';
            messageCount++;

            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                processMessage(message);
            }, 1500);
        }

        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Process messages with keyword matching
        function processMessage(message) {
            const lowerMsg = message.toLowerCase();

            if (lowerMsg.includes('production') || lowerMsg.includes('status') || lowerMsg.includes('output')) {
                showProductionStatus();
            } else if (lowerMsg.includes('tank') || lowerMsg.includes('inventory') || lowerMsg.includes('stock') || lowerMsg.includes('level')) {
                showTankLevels();
            } else if (lowerMsg.includes('cost') || lowerMsg.includes('price') || lowerMsg.includes('expense')) {
                showCostAnalysis();
            } else if (lowerMsg.includes('option') || lowerMsg.includes('scenario') || lowerMsg.includes('what should') || lowerMsg.includes('recommend')) {
                showScenarios();
            } else if (lowerMsg.includes('why') || lowerMsg.includes('explain') || lowerMsg.includes('reason')) {
                showExplainability();
            } else {
                addSystemMessage('I can help you with: production status, tank levels, cost analysis, and optimization scenarios. What would you like to explore?');
            }

            // Crisis will be triggered by demo events from index.html
        }

        // Visualization functions
        function showProductionStatus() {
            addSystemMessage('Here is your current production status for October 2025:');
            updateVizTitle('Production Status - ME5 & ME6 Units');
            
            const data = operationalData.production;
            const progress = Math.round((data.currentProduction / data.monthlyTarget) * 100);
            
            const content = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Monthly Target</div>
                        <div class="metric-value">${data.monthlyTarget.toLocaleString()} MT</div>
                        <div class="metric-change positive">▲ On track</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Current Production</div>
                        <div class="metric-value">${data.currentProduction.toLocaleString()} MT</div>
                        <div class="metric-change positive">▲ ${progress}% complete</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Daily Average</div>
                        <div class="metric-value">${data.dailyOutput} MT/day</div>
                        <div class="metric-change positive">▲ Above baseline</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="productionChart"></canvas>
                </div>
            `;
            
            document.getElementById('vizContent').innerHTML = content;
            
            // Create production chart
            const ctx = document.getElementById('productionChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4 (Projected)'],
                    datasets: [
                        {
                            label: 'Forecasted',
                            data: [7250, 7250, 7250, 7250],
                            backgroundColor: 'rgba(139, 46, 139, 0.2)',
                            borderColor: 'rgba(139, 46, 139, 1)',
                            borderWidth: 2
                        },
                        {
                            label: 'Actual',
                            data: [7340, 7180, 8100, 0],
                            backgroundColor: 'rgba(22, 163, 74, 0.6)',
                            borderColor: 'rgba(22, 163, 74, 1)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Monthly Production Performance (MT)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Metric Tons (MT)'
                            }
                        }
                    }
                }
            });
        }

        function showTankLevels() {
            addSystemMessage('Current tank inventory status:');
            updateVizTitle('Tank Capacity & Inventory Levels');
            
            const data = operationalData.inventory;
            const utilization = Math.round((data.tankLevel / data.tankCapacity) * 100);
            const availableSpace = data.tankCapacity - data.tankLevel;
            
            const content = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Current Inventory</div>
                        <div class="metric-value">${data.tankLevel.toLocaleString()} MT</div>
                        <div class="metric-change positive">▲ Safe zone (${data.safeRange.min}K-${data.safeRange.max}K)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Tank Capacity</div>
                        <div class="metric-value">${data.tankCapacity.toLocaleString()} MT</div>
                        <div class="metric-change neutral">${utilization}% utilized</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Available Space</div>
                        <div class="metric-value">${availableSpace.toLocaleString()} MT</div>
                        <div class="metric-change positive">▲ ${Math.round((availableSpace / data.tankCapacity) * 100)}% buffer</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="tankChart"></canvas>
                </div>
                <div style="margin-top: 2rem; padding: 1rem; background: rgba(22, 163, 74, 0.1); border-left: 4px solid #16A34A; border-radius: 8px;">
                    <strong>Co-mingled Inventory:</strong><br>
                    • Mitsui: ${data.mitsuiAllocation} MT<br>
                    • Akema: ${data.akemaAllocation} MT<br>
                    • Working Capacity Max: ${data.tankCapacity.toLocaleString()} MT<br>
                    • Combined Heel Stock: ${data.heelStock} MT
                </div>
            `;
            
            document.getElementById('vizContent').innerHTML = content;
            
            // Create tank chart
            const ctx = document.getElementById('tankChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Current Stock', 'Mitsui Allocation', 'Available Capacity'],
                    datasets: [{
                        data: [3600, 600, 2100],
                        backgroundColor: [
                            'rgba(139, 46, 139, 0.8)',
                            'rgba(168, 85, 247, 0.6)',
                            'rgba(229, 231, 235, 0.5)'
                        ],
                        borderColor: [
                            'rgba(139, 46, 139, 1)',
                            'rgba(168, 85, 247, 1)',
                            'rgba(229, 231, 235, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Tank Distribution (Total: 6,300 MT)'
                        }
                    }
                }
            });
        }

        function showCostAnalysis() {
            addSystemMessage('Here is your production cost analysis for October:');
            updateVizTitle('Production Cost Analysis');
            
            const data = operationalData.costs;
            const savings = data.monthlyBudget - data.monthlyActual;
            const savingsPercent = Math.round((savings / data.monthlyBudget) * 100);
            
            const content = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Total Production Cost</div>
                        <div class="metric-value">$${data.monthlyActual}M</div>
                        <div class="metric-change positive">▼ ${savingsPercent}% vs budget</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Cost per MT</div>
                        <div class="metric-value">$${data.costPerMT}</div>
                        <div class="metric-change positive">▼ Optimized</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Daily Cost</div>
                        <div class="metric-value">$${data.dailyCost}K</div>
                        <div class="metric-change positive">▲ Within budget</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="costChart"></canvas>
                </div>
            `;
            
            document.getElementById('vizContent').innerHTML = content;
            
            // Create cost chart
            const ctx = document.getElementById('costChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [
                        {
                            label: 'Forecasted Cost',
                            data: [575, 575, 575, 575],
                            borderColor: 'rgba(234, 88, 12, 1)',
                            backgroundColor: 'rgba(234, 88, 12, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        },
                        {
                            label: 'Actual Cost',
                            data: [562, 548, 595, 520],
                            borderColor: 'rgba(22, 163, 74, 1)',
                            backgroundColor: 'rgba(22, 163, 74, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Weekly Production Cost Trends ($K)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Cost ($K)'
                            }
                        }
                    }
                }
            });
        }

        // Crisis trigger
        function triggerCrisis(scenarioType = null) {
            crisisTriggered = true;
            conversationState = 'crisis';
            
            // Set scenario type if provided
            if (scenarioType) {
                currentScenarioType = scenarioType;
                document.getElementById('scenarioSelector').value = scenarioType;
            }
            
            // Hide quick actions during crisis
            document.getElementById('quickActions').style.display = 'none';
            
            // Clear any existing messages
            document.getElementById('chatMessages').innerHTML = '';
            
            const scenario = scenarioData[currentScenarioType];
            addSystemMessage(`⚠️ ALERT: ${scenario.description}. Analyzing production impact...`, true);
            
            setTimeout(() => {
                showCrisisImpact();
            }, 2000);
        }

        function showCrisisImpact() {
            const scenario = scenarioData[currentScenarioType];
            const impact = scenario.impact;
            
            addSystemMessage(`Impact analysis complete. ${scenario.name} will reduce daily production by ${impact.productionReduction} MT. Estimated downtime: ${impact.downtime}.`);
            updateVizTitle(`⚠️ Crisis Impact Analysis - ${scenario.name}`);
            
            const content = `
                <div style="background: #FEF2F2; border: 2px solid #DC2626; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
                    <h3 style="color: #DC2626; margin-bottom: 1rem;">⚠️ ${scenario.name} Alert</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                        <div>
                            <strong>${currentScenarioType === 'equipment_failure' ? 'Equipment' : 'Material'}:</strong> ${currentScenarioType === 'equipment_failure' ? impact.affectedUnit : impact.affectedMaterial}<br>
                            <strong>Status:</strong> ${currentScenarioType === 'equipment_failure' ? 'Offline' : 'Delayed'}<br>
                            <strong>Time:</strong> ${impact.detectionTime}
                        </div>
                        <div>
                            <strong>Estimated Downtime:</strong> ${impact.downtime}<br>
                            <strong>Production Impact:</strong> -${impact.productionReduction} MT/day<br>
                            <strong>Total Shortfall:</strong> ${impact.totalShortfall}
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="impactChart"></canvas>
                </div>
                <div style="margin-top: 2rem; padding: 1rem; background: rgba(139, 46, 139, 0.1); border-left: 4px solid #8B2E8B; border-radius: 8px;">
                    <strong>Current Situation:</strong><br>
                    • Daily target: 965 MT → Reduced to ${965 - impact.productionReduction} MT<br>
                    • Monthly forecast at risk: 78% → ${Math.round(78 - (impact.productionReduction/965)*100)}% projected<br>
                    • Customer commitments may be impacted<br>
                    • Tank inventory buffer: 4,200 MT (6.8 days coverage)
                </div>
            `;
            
            document.getElementById('vizContent').innerHTML = content;
            
            // Create impact chart with scenario-specific data
            const ctx = document.getElementById('impactChart').getContext('2d');
            const beforeValue = 965;
            const duringValue = beforeValue - impact.productionReduction;
            const recoveryValue = beforeValue - Math.round(impact.productionReduction * 0.3);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Before Crisis', 'During Crisis', 'Recovery Period'],
                    datasets: [
                        {
                            label: 'Daily Production (MT)',
                            data: [beforeValue, duringValue, recoveryValue],
                            backgroundColor: [
                                'rgba(22, 163, 74, 0.6)',
                                'rgba(220, 38, 38, 0.6)',
                                'rgba(234, 88, 12, 0.6)'
                            ],
                            borderColor: [
                                'rgba(22, 163, 74, 1)',
                                'rgba(220, 38, 38, 1)',
                                'rgba(234, 88, 12, 1)'
                            ],
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Production Impact Comparison'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Daily Production (MT)'
                            }
                        }
                    }
                }
            });
            
            setTimeout(() => {
                addSystemMessage('I have analyzed multiple response options. Would you like to see the recommended scenarios?');
            }, 2000);
        }

        function showScenarios() {
            addSystemMessage('Analyzing optimization scenarios based on current constraints...');
            updateVizTitle(`Optimization Scenarios - ${scenarioData[currentScenarioType].name}`);
            
            // Show scenarios one by one
            setTimeout(() => {
                showScenarioA();
            }, 1000);
        }

        function showScenarioA() {
            const scenario = scenarioData[currentScenarioType].scenarios[0];
            const details = scenario.details;
            const costSign = scenario.costImpact < 0 ? '-' : '+';
            const costValue = Math.abs(scenario.costImpact);
            
            const content = `
                <div class="scenario-card recommended">
                    <div class="scenario-header">
                        <div class="scenario-title">📈 Scenario A: ${scenario.title}</div>
                        <span class="scenario-badge badge-recommended">✓ RECOMMENDED</span>
                    </div>
                    <p style="margin: 1rem 0; line-height: 1.6;">
                        ${scenario.description}
                    </p>
                    <div class="scenario-metrics">
                        <div class="scenario-metric">
                            <div class="scenario-metric-label">Cost Impact</div>
                            <div class="scenario-metric-value ${scenario.costImpact < 0 ? 'value-positive' : 'value-negative'}">${costSign}$${costValue.toLocaleString()}</div>
                        </div>
                        <div class="scenario-metric">
                            <div class="scenario-metric-label">Timeline</div>
                            <div class="scenario-metric-value value-positive">${scenario.timeline}</div>
                        </div>
                        <div class="scenario-metric">
                            <div class="scenario-metric-label">Risk Level</div>
                            <div class="scenario-metric-value value-positive">${scenario.riskLevel}</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px;">
                        <strong>Financial Analysis:</strong><br>
                        ${Object.entries(details).filter(([key, value]) => key !== 'netSavings' && key !== 'netCost' && key !== 'customerRisk' && key !== 'qualityRisk').map(([key, value]) => `• ${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}: ${value < 0 ? '-' : '+'}$${Math.abs(value).toLocaleString()}`).join('<br>')}<br>
                        • <strong>Net ${scenario.costImpact < 0 ? 'Savings' : 'Cost'}: $${Math.abs(scenario.costImpact).toLocaleString()}</strong>
                    </div>
                </div>
            `;
            
            document.getElementById('vizContent').innerHTML = content;
            addSystemMessage(`Scenario A: ${scenario.title}. Net ${scenario.costImpact < 0 ? 'savings' : 'cost'}: $${Math.abs(scenario.costImpact).toLocaleString()}. Timeline: ${scenario.timeline}.`);
            
            setTimeout(() => {
                showScenarioB();
            }, 3000);
        }

        function showScenarioB() {
            const scenario = scenarioData[currentScenarioType].scenarios[1];
            const details = scenario.details;
            const costSign = scenario.costImpact < 0 ? '-' : '+';
            const costValue = Math.abs(scenario.costImpact);
            
            const existingContent = document.getElementById('vizContent').innerHTML;
            const content = existingContent + `
                <div class="scenario-card">
                    <div class="scenario-header">
                        <div class="scenario-title">🌏 Scenario B: ${scenario.title}</div>
                    </div>
                    <p style="margin: 1rem 0; line-height: 1.6;">
                        ${scenario.description}
                    </p>
                    <div class="scenario-metrics">
                        <div class="scenario-metric">
                            <div class="scenario-metric-label">Cost Impact</div>
                            <div class="scenario-metric-value ${scenario.costImpact < 0 ? 'value-positive' : 'value-negative'}">${costSign}$${costValue.toLocaleString()}</div>
                        </div>
                        <div class="scenario-metric">
                            <div class="scenario-metric-label">Timeline</div>
                            <div class="scenario-metric-value value-neutral">${scenario.timeline}</div>
                        </div>
                        <div class="scenario-metric">
                            <div class="scenario-metric-label">Risk Level</div>
                            <div class="scenario-metric-value value-neutral">${scenario.riskLevel}</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px;">
                        <strong>Financial Analysis:</strong><br>
                        ${Object.entries(details).filter(([key, value]) => key !== 'netSavings' && key !== 'netCost' && key !== 'customerRisk' && key !== 'qualityRisk').map(([key, value]) => `• ${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}: ${value < 0 ? '-' : '+'}$${Math.abs(value).toLocaleString()}`).join('<br>')}<br>
                        • <strong>Net ${scenario.costImpact < 0 ? 'Savings' : 'Cost'}: $${Math.abs(scenario.costImpact).toLocaleString()}</strong>
                    </div>
                </div>
            `;
            
            document.getElementById('vizContent').innerHTML = content;
            addSystemMessage(`Scenario B: ${scenario.title}. Net ${scenario.costImpact < 0 ? 'savings' : 'cost'}: $${Math.abs(scenario.costImpact).toLocaleString()}. Timeline: ${scenario.timeline}.`);
            
            setTimeout(() => {
                showScenarioC();
            }, 3000);
        }

        function showScenarioC() {
            const scenario = scenarioData[currentScenarioType].scenarios[2];
            const details = scenario.details;
            const costSign = scenario.costImpact < 0 ? '-' : '+';
            const costValue = Math.abs(scenario.costImpact);
            
            const existingContent = document.getElementById('vizContent').innerHTML;
            const content = existingContent + `
                <div class="scenario-card">
                    <div class="scenario-header">
                        <div class="scenario-title">📦 Scenario C: ${scenario.title}</div>
                    </div>
                    <p style="margin: 1rem 0; line-height: 1.6;">
                        ${scenario.description}
                    </p>
                    <div class="scenario-metrics">
                        <div class="scenario-metric">
                            <div class="scenario-metric-label">Cost Impact</div>
                            <div class="scenario-metric-value ${scenario.costImpact < 0 ? 'value-positive' : 'value-negative'}">${costSign}$${costValue.toLocaleString()}</div>
                        </div>
                        <div class="scenario-metric">
                            <div class="scenario-metric-label">Timeline</div>
                            <div class="scenario-metric-value value-negative">${scenario.timeline}</div>
                        </div>
                        <div class="scenario-metric">
                            <div class="scenario-metric-label">Risk Level</div>
                            <div class="scenario-metric-value value-negative">${scenario.riskLevel}</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px;">
                        <strong>Financial Analysis:</strong><br>
                        ${Object.entries(details).filter(([key, value]) => key !== 'netSavings' && key !== 'netCost' && key !== 'customerRisk' && key !== 'qualityRisk').map(([key, value]) => `• ${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}: ${value < 0 ? '-' : '+'}$${Math.abs(value).toLocaleString()}`).join('<br>')}<br>
                        • <strong>Net ${scenario.costImpact < 0 ? 'Savings' : 'Cost'}: $${Math.abs(scenario.costImpact).toLocaleString()}</strong>
                        ${details.customerRisk ? '<br><span style="color: #DC2626;">⚠️ Requires customer approval & impacts relationships</span>' : ''}
                        ${details.qualityRisk ? '<br><span style="color: #DC2626;">⚠️ Quality risk with alternative feedstock</span>' : ''}
                    </div>
                </div>
            `;
            
            document.getElementById('vizContent').innerHTML = content;
            addSystemMessage(`Scenario C: ${scenario.title}. Net ${scenario.costImpact < 0 ? 'savings' : 'cost'}: $${Math.abs(scenario.costImpact).toLocaleString()}. Timeline: ${scenario.timeline}. Note: ${scenario.riskLevel} risk level.`);
            
            setTimeout(() => {
                addSystemMessage('Based on comprehensive analysis, I recommend Scenario A. Would you like to understand why?');
            }, 2000);
        }

        function showExplainability() {
            addSystemMessage('Here is the detailed reasoning behind my recommendation for Scenario A:');
            updateVizTitle('AI Explainability - Why Scenario A?');
            
            const content = `
                <div class="explainability-panel">
                    <div class="explainability-title">🧠 Decision Reasoning: Why Scenario A is Optimal</div>
                    <div class="explainability-reasons">
                        <div class="reason-item">
                            <div class="reason-icon">1</div>
                            <div class="reason-text">
                                <strong>Immediate Execution Capability:</strong> ME5 unit has available capacity headroom (currently at 85% utilization). 
                                No lead time required - can begin compensation immediately.
                            </div>
                        </div>
                        <div class="reason-item">
                            <div class="reason-icon">2</div>
                            <div class="reason-text">
                                <strong>Best Financial Outcome:</strong> Net savings of $25K vs $60K cost (Scenario B) or $30K savings with high risk (Scenario C). 
                                Clear economic advantage.
                            </div>
                        </div>
                        <div class="reason-item">
                            <div class="reason-icon">3</div>
                            <div class="reason-text">
                                <strong>Tank Buffer Provides Safety:</strong> Current inventory of 4,200 MT provides 6.8 days coverage during ME5 ramp-up period. 
                                No immediate customer impact risk.
                            </div>
                        </div>
                        <div class="reason-item">
                            <div class="reason-icon">4</div>
                            <div class="reason-text">
                                <strong>Low Operational Risk:</strong> ME5 operates within design parameters at 105% capacity. 
                                Historical data shows reliable performance at these levels.
                            </div>
                        </div>
                        <div class="reason-item">
                            <div class="reason-icon">5</div>
                            <div class="reason-text">
                                <strong>No External Dependencies:</strong> Unlike Scenario B (requires Malaysia coordination) or Scenario C (customer approvals), 
                                Scenario A can be executed with local team only.
                            </div>
                        </div>
                        <div class="reason-item">
                            <div class="reason-icon">6</div>
                            <div class="reason-text">
                                <strong>Maintains Customer Relationships:</strong> Zero customer impact means no relationship risk, 
                                unlike Scenario C which could strain customer trust.
                            </div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(to right, rgba(22, 163, 74, 0.1), white); border-left: 4px solid #16A34A; border-radius: 8px;">
                    <h4 style="color: #16A34A; margin-bottom: 1rem;">✓ Recommended Next Steps</h4>
                    <ol style="line-height: 1.8; padding-left: 1.5rem;">
                        <li>Notify Plant Manager to increase ME5 to 105% capacity</li>
                        <li>Adjust raw material delivery schedule (+15% hydrogen)</li>
                        <li>Update IBP forecast to reflect ME6 downtime</li>
                        <li>Monitor ME5 performance metrics hourly during ramp-up</li>
                        <li>Prepare contingency (Scenario B) if ME6 downtime exceeds 5 days</li>
                    </ol>
                </div>
                <div class="chart-container" style="margin-top: 2rem;">
                    <canvas id="comparisonChart"></canvas>
                </div>
            `;
            
            document.getElementById('vizContent').innerHTML = content;
            
            // Create comparison chart
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Cost Efficiency', 'Speed', 'Risk Level', 'Customer Impact', 'Operational Ease', 'Success Probability'],
                    datasets: [
                        {
                            label: 'Scenario A',
                            data: [95, 100, 90, 100, 95, 95],
                            borderColor: 'rgba(22, 163, 74, 1)',
                            backgroundColor: 'rgba(22, 163, 74, 0.2)',
                            borderWidth: 2
                        },
                        {
                            label: 'Scenario B',
                            data: [60, 70, 75, 85, 60, 80],
                            borderColor: 'rgba(234, 88, 12, 1)',
                            backgroundColor: 'rgba(234, 88, 12, 0.2)',
                            borderWidth: 2
                        },
                        {
                            label: 'Scenario C',
                            data: [70, 60, 40, 30, 80, 65],
                            borderColor: 'rgba(220, 38, 38, 1)',
                            backgroundColor: 'rgba(220, 38, 38, 0.2)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Multi-Factor Scenario Comparison (0-100 scale)'
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function switchRole() {
            const selector = document.getElementById('roleSelector');
            currentRole = selector.value;
            
            // Clear chat and restart
            document.getElementById('chatMessages').innerHTML = '';
            document.getElementById('vizContent').innerHTML = `
                <div class="viz-placeholder">
                    <div class="viz-placeholder-icon">📊</div>
                    <h3>Ask me a question to get started</h3>
                    <p>I can show you production metrics, tank levels, cost analysis, and optimization scenarios</p>
                </div>
            `;
            
            messageCount = 0;
            crisisTriggered = false;
            conversationState = 'initial';
            document.getElementById('quickActions').style.display = 'flex';
            
            initChat();
        }

        function switchScenario() {
            const selector = document.getElementById('scenarioSelector');
            currentScenarioType = selector.value;
            
            // If crisis is already triggered, update the display
            if (crisisTriggered) {
                showCrisisImpact();
            }
        }

        function updateVizTitle(title) {
            document.getElementById('vizTitle').textContent = title;
            const now = new Date();
            document.getElementById('vizTimestamp').textContent = `Updated: ${now.toLocaleTimeString()}`;
        }

        // Check for crisis parameter in URL
        function checkForCrisisParameter() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('crisis') === 'true') {
                // Clear the URL parameter to prevent re-triggering on refresh
                const newUrl = window.location.pathname;
                window.history.replaceState({}, document.title, newUrl);
                
                // Trigger crisis immediately
                setTimeout(() => {
                    triggerCrisis();
                }, 1000);
                return true;
            }
            return false;
        }

        // Demo trigger detection
        function checkForDemoTrigger() {
            const eventData = localStorage.getItem('evonik_coordination_event');
            if (eventData) {
                const event = JSON.parse(eventData);
                if (event.demo_trigger && (event.type === 'equipment_failure' || event.type === 'supply_delay')) {
                    // Clear the event to prevent re-triggering
                    localStorage.removeItem('evonik_coordination_event');
                    
                    // Trigger crisis with specific scenario type
                    setTimeout(() => {
                        triggerCrisis(event.type);
                    }, 1000);
                }
            }
        }

        // Check for demo triggers every 500ms
        setInterval(checkForDemoTrigger, 500);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check for crisis parameter first
            if (!checkForCrisisParameter()) {
                initChat();
            }
            checkForDemoTrigger();
        });
    </script>
</body>
</html>