<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Supply Chain Dashboard - Jason Neo</title>
    <link rel="stylesheet" href="shared-styles.css">
    <style>
        /* Page-specific styles for local-supply-chain.html */
        .header {
            background: linear-gradient(135deg, var(--supply-orange) 0%, #C2410C 100%);
        }

        .back-btn:hover {
            color: var(--supply-orange);
        }

        .materials-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .material-card {
            background: var(--bg-gray);
            padding: 1.5rem;
            border-radius: 8px;
            border: 2px solid var(--border-gray);
            transition: border-color 0.3s;
        }

        .material-card:hover {
            border-color: var(--supply-orange);
        }

        .material-card.critical {
            border-color: var(--alert-red);
            background: rgba(220, 38, 38, 0.05);
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .material-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .material-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-adequate {
            background: rgba(22, 163, 74, 0.1);
            color: var(--success-green);
        }

        .status-monitor {
            background: rgba(234, 88, 12, 0.1);
            color: var(--warning-orange);
        }

        .status-critical {
            background: rgba(220, 38, 38, 0.1);
            color: var(--alert-red);
        }

        .material-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .material-metric-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .material-metric-value {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .procurement-table tr:hover {
            background: rgba(234, 88, 12, 0.05);
        }

        .sync-detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .sync-module {
            padding: 1rem;
            background: var(--bg-gray);
            border-radius: 8px;
            border-left: 4px solid var(--success-green);
        }

        .sync-module.warning {
            border-left-color: var(--warning-orange);
        }

        .sync-module-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .sync-time {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        @media (max-width: 1024px) {
            .materials-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .sync-detail-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .materials-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">üìä Evonik</div>
                <div>
                    <div style="font-size: 1.2rem; font-weight: 600;">Local Supply Chain Dashboard</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Inventory & Procurement Management - Singapore</div>
                </div>
            </div>
            <div class="user-info">
                <div style="font-size: 1.1rem; font-weight: 600;">Jason Neo</div>
                <div style="font-size: 0.9rem; opacity: 0.9;">Local Supply Chain Manager</div>
            </div>
        </div>
    </header>

    <nav class="back-nav">
        <div class="nav-content">
            <a href="index.html" class="back-btn">‚Üê Back to Coordination Hub</a>
            <a href="optimizer.html" class="optimizer-btn">
                AI Decision Support
            </a>
            <div class="breadcrumb">Local Supply Chain</div>
        </div>
    </nav>

    <div class="alerts-banner" id="alertsBanner">
        <strong>SUPPLY CHAIN ALERT:</strong> <span id="alertMessage"></span>
    </div>

    <main class="main-content">
        <!-- SAP Integration Status -->
        <h2 class="section-title">SAP Integration Status</h2>
        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Sync Health</div>
                    <div class="card-status status-operational" id="syncHealth">Active</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Last Sync</div>
                    <div class="metric-value" id="lastSync">2 min ago</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Next Sync</div>
                    <div class="metric-value">3 min</div>
                    <div class="metric-subtext">Auto-sync every 5 minutes</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Data Freshness</div>
                    <div class="card-status status-operational">Current</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Production Data</div>
                    <div class="metric-value" style="font-size: 1rem;">2 min ago</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Inventory Data</div>
                    <div class="metric-value" style="font-size: 1rem;">2 min ago</div>
                </div>
                <div class="metric">
                    <div class="metric-label">PO Data</div>
                    <div class="metric-value" style="font-size: 1rem;">5 min ago</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Sync Errors</div>
                    <div class="card-status status-operational" id="syncErrors">None</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Last 24 Hours</div>
                    <div class="metric-value">0</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Last Failed Sync</div>
                    <div class="metric-value" style="font-size: 1rem;">Oct 18</div>
                    <div class="metric-subtext">MM module timeout (resolved)</div>
                </div>
            </div>
        </div>

        <!-- Procurement Overview -->
        <h2 class="section-title">Procurement Pipeline</h2>
        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Open Purchase Orders</div>
                    <div class="card-status status-operational">12 active</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Total Value</div>
                    <div class="metric-value">$2.8M</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Urgent Items</div>
                    <div class="metric-value" style="color: var(--warning-orange);" id="urgentPOs">2</div>
                    <div class="metric-subtext">Require confirmation</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Deliveries This Week</div>
                    <div class="card-status status-operational">5 expected</div>
                </div>
                <div class="metric">
                    <div class="metric-label">On Schedule</div>
                    <div class="metric-value">4</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Delayed</div>
                    <div class="metric-value" style="color: var(--warning-orange);" id="delayedDeliveries">1</div>
                    <div class="metric-subtext">Methanol - 2 days late</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Supplier Performance</div>
                    <div class="card-status status-operational">Good</div>
                </div>
                <div class="metric">
                    <div class="metric-label">On-Time Delivery Rate</div>
                    <div class="metric-value">94%</div>
                    <div class="metric-subtext">Last 30 days</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Quality Issues</div>
                    <div class="metric-value">0</div>
                </div>
            </div>
        </div>
<!-- Products Shipped Out (OAS Weighing System) -->
<h2 class="section-title">Products Shipped Out (OAS Tracking)</h2>
<p class="section-note" style="color: var(--text-light); font-size: 0.9rem; margin: -0.5rem 0 1rem 0;">
    ‚ÑπÔ∏è Finished product inventory is managed by <strong>Katoen Natie</strong> (third-party logistics partner). 
    This section tracks products leaving the Singapore facility (OAS weighing machine).
</p>
<div class="dashboard-grid">
    <div class="card">
        <div class="card-header">
            <div class="card-title">Today's Shipments</div>
            <div class="card-status status-operational" id="shipmentStatus">On Track</div>
        </div>
        <div class="metric">
            <div class="metric-label">Shipped Today</div>
            <div class="metric-value" id="todayShipped">782 MT</div>
            <div class="metric-subtext">12 truck loads</div>
        </div>
        <div class="metric">
            <div class="metric-label">Target Daily Output</div>
            <div class="metric-value">965 MT/day</div>
        </div>
        <div class="metric">
            <div class="metric-label">Achievement</div>
            <div class="metric-value" style="font-size: 1rem; color: var(--success-green);">81%</div>
            <div class="metric-subtext">As of 2:30 PM</div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">Monthly Cumulative</div>
            <div class="card-status status-operational">Ahead of Target</div>
        </div>
        <div class="metric">
            <div class="metric-label">Shipped This Month</div>
            <div class="metric-value" id="monthlyShipped">13,420 MT</div>
            <div class="metric-subtext">Oct 1 - Oct 15</div>
        </div>
        <div class="metric">
            <div class="metric-label">Monthly Target</div>
            <div class="metric-value">28,950 MT</div>
        </div>
        <div class="metric">
            <div class="metric-label">Progress</div>
            <div class="metric-value" style="font-size: 1rem;">46.4%</div>
            <div class="metric-subtext">15 days elapsed (48.4%)</div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">OAS Integration</div>
            <div class="card-status status-operational" id="oasStatus">Connected</div>
        </div>
        <div class="metric">
            <div class="metric-label">Last Weighing</div>
            <div class="metric-value" style="font-size: 1rem;" id="lastWeighing">3 min ago</div>
            <div class="metric-subtext">Truck #SG-4829 | 68 MT</div>
        </div>
        <div class="metric">
            <div class="metric-label">System Status</div>
            <div class="metric-value" style="font-size: 1rem; color: var(--success-green);">Online</div>
        </div>
        <div class="metric">
            <div class="metric-label">Data Sync</div>
            <div class="metric-value" style="font-size: 1rem;">Real-time</div>
            <div class="metric-subtext">Auto-sync enabled</div>
        </div>
    </div>
</div>

<!-- Recent Shipments Table -->
<div class="section-panel">
    <h3 class="section-title">Recent Shipments (Last 24 Hours)</h3>
    <table class="procurement-table">
        <thead>
            <tr>
                <th>Time</th>
                <th>Truck ID</th>
                <th>Weight (MT)</th>
                <th>Destination</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="shipmentsTableBody">
            <tr>
                <td>14:27</td>
                <td>SG-4829</td>
                <td>68 MT</td>
                <td>Katoen Natie Warehouse</td>
                <td><span class="po-status po-delivered" style="background: rgba(22, 163, 74, 0.1); color: var(--success-green);">Delivered</span></td>
            </tr>
            <tr>
                <td>13:15</td>
                <td>SG-4801</td>
                <td>65 MT</td>
                <td>Katoen Natie Warehouse</td>
                <td><span class="po-status po-delivered" style="background: rgba(22, 163, 74, 0.1); color: var(--success-green);">Delivered</span></td>
            </tr>
            <tr>
                <td>11:42</td>
                <td>SG-4788</td>
                <td>67 MT</td>
                <td>Katoen Natie Warehouse</td>
                <td><span class="po-status po-delivered" style="background: rgba(22, 163, 74, 0.1); color: var(--success-green);">Delivered</span></td>
            </tr>
            <tr>
                <td>10:18</td>
                <td>SG-4773</td>
                <td>66 MT</td>
                <td>Katoen Natie Warehouse</td>
                <td><span class="po-status po-delivered" style="background: rgba(22, 163, 74, 0.1); color: var(--success-green);">Delivered</span></td>
            </tr>
            <tr>
                <td>08:55</td>
                <td>SG-4762</td>
                <td>64 MT</td>
                <td>Katoen Natie Warehouse</td>
                <td><span class="po-status po-delivered" style="background: rgba(22, 163, 74, 0.1); color: var(--success-green);">Delivered</span></td>
            </tr>
        </tbody>
    </table>
</div>
        <!-- Raw Materials -->
        <div class="section-panel">
            <h3 class="section-title">Raw Materials Status</h3>
            <div class="materials-grid">
                <div class="material-card">
                    <div class="material-header">
                        <div class="material-name">Hydrogen (H2)</div>
                        <div class="material-status status-adequate">Adequate</div>
                    </div>
                    <div class="material-metrics">
                        <div>
                            <div class="material-metric-label">Current Stock</div>
                            <div class="material-metric-value" id="h2Stock">4,800 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Consumption</div>
                            <div class="material-metric-value">85 MT/day</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Reorder Point</div>
                            <div class="material-metric-value">2,500 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Lead Time</div>
                            <div class="material-metric-value">14 days</div>
                        </div>
                    </div>
                </div>

                <div class="material-card">
                    <div class="material-header">
                        <div class="material-name">MMP</div>
                        <div class="material-status status-adequate">Adequate</div>
                    </div>
                    <div class="material-metrics">
                        <div>
                            <div class="material-metric-label">Current Stock</div>
                            <div class="material-metric-value" id="mmpStock">1,850 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Consumption</div>
                            <div class="material-metric-value">42 MT/day</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Reorder Point</div>
                            <div class="material-metric-value">1,200 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Lead Time</div>
                            <div class="material-metric-value">21 days</div>
                        </div>
                    </div>
                </div>

                <div class="material-card" id="methanolCard">
                    <div class="material-header">
                        <div class="material-name">Methanol (CH3OH)</div>
                        <div class="material-status status-monitor" id="methanolStatus">Monitor</div>
                    </div>
                    <div class="material-metrics">
                        <div>
                            <div class="material-metric-label">Current Stock</div>
                            <div class="material-metric-value" id="methanolStock">980 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Consumption</div>
                            <div class="material-metric-value">38 MT/day</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Reorder Point</div>
                            <div class="material-metric-value">800 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Lead Time</div>
                            <div class="material-metric-value">18 days</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Purchase Orders -->
        <div class="section-panel">
            <h3 class="section-title">Active Purchase Orders</h3>
            <table class="procurement-table">
                <thead>
                    <tr>
                        <th>PO Number</th>
                        <th>Material</th>
                        <th>Quantity</th>
                        <th>Supplier</th>
                        <th>Expected Delivery</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="poTableBody">
                    <tr>
                        <td>PO-2847</td>
                        <td>Hydrogen</td>
                        <td>1,500 MT</td>
                        <td>Supplier A</td>
                        <td>Oct 28, 2025</td>
                        <td><span class="po-status po-transit">In Transit</span></td>
                    </tr>
                    <tr>
                        <td>PO-2848</td>
                        <td>Methanol</td>
                        <td>850 MT</td>
                        <td>Supplier B</td>
                        <td>Oct 26, 2025</td>
                        <td><span class="po-status po-urgent">Delayed 2d</span></td>
                    </tr>
                    <tr>
                        <td>PO-2849</td>
                        <td>MMP</td>
                        <td>600 MT</td>
                        <td>Supplier C</td>
                        <td>Nov 2, 2025</td>
                        <td><span class="po-status po-open">Confirmed</span></td>
                    </tr>
                    <tr>
                        <td>PO-2850</td>
                        <td>Hydrogen</td>
                        <td>2,000 MT</td>
                        <td>Supplier A</td>
                        <td>Nov 5, 2025</td>
                        <td><span class="po-status po-open">Awaiting Confirmation</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- SAP Module Sync Details -->
        <div class="section-panel">
            <h3 class="section-title">SAP Module Sync Details</h3>
            <div class="sync-detail-grid">
                <div class="sync-module">
                    <div class="sync-module-name">MM (Materials Management)</div>
                    <div class="sync-time">Last sync: 2 minutes ago</div>
                    <div class="sync-time">Status: Active | No errors</div>
                </div>
                <div class="sync-module">
                    <div class="sync-module-name">PP (Production Planning)</div>
                    <div class="sync-time">Last sync: 2 minutes ago</div>
                    <div class="sync-time">Status: Active | No errors</div>
                </div>
                <div class="sync-module">
                    <div class="sync-module-name">IM (Inventory Management)</div>
                    <div class="sync-time">Last sync: 2 minutes ago</div>
                    <div class="sync-time">Status: Active | No errors</div>
                </div>
                <div class="sync-module">
                    <div class="sync-module-name">PUR (Purchasing)</div>
                    <div class="sync-time">Last sync: 5 minutes ago</div>
                    <div class="sync-time">Status: Active | No errors</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Listen for coordination events
        window.addEventListener('storage', function(e) {
            if (e.key === 'evonik_coordination_event') {
                const eventData = JSON.parse(e.newValue);
                handleCoordinationEvent(eventData);
            }
        });

        function handleCoordinationEvent(event) {
            switch(event.type) {
                case 'equipment_failure':
                    showAlert('ME6 shutdown detected - Monitor tank depletion rate');
                    // Shipment metrics can be re-evaluated here if needed
                    updateShipmentMetrics();
                    break;
                case 'supply_chain_adjustment':
                    showAlert('Methanol shipment delayed - Alternative sourcing required');
                    updateMethanolDelay();
                    break;
                case 'reset':
                    resetDashboard();
                    break;
            }
        }

        function showAlert(message) {
            const banner = document.getElementById('alertsBanner');
            document.getElementById('alertMessage').textContent = message;
            banner.classList.add('show');
            setTimeout(() => banner.classList.remove('show'), 8000);
        }

        function updateMethanolDelay() {
            const methanolCard = document.getElementById('methanolCard');
            methanolCard.classList.add('critical');
            document.getElementById('methanolStock').textContent = '780 MT';
            document.getElementById('methanolStatus').className = 'material-status status-critical';
            document.getElementById('methanolStatus').textContent = 'Critical';
            document.getElementById('delayedDeliveries').textContent = '1';
            document.getElementById('urgentPOs').textContent = '3';
        }

        function resetDashboard() {
            document.getElementById('alertsBanner').classList.remove('show');
            // Reset shipment tracking defaults
            document.getElementById('shipmentStatus').textContent = 'On Track';
            document.getElementById('lastWeighing').textContent = '3 min ago';
            document.getElementById('todayShipped').textContent = '782 MT';
            
            const methanolCard = document.getElementById('methanolCard');
            methanolCard.classList.remove('critical');
            document.getElementById('methanolStock').textContent = '980 MT';
            document.getElementById('methanolStatus').className = 'material-status status-monitor';
            document.getElementById('methanolStatus').textContent = 'Monitor';
            document.getElementById('delayedDeliveries').textContent = '1';
            document.getElementById('urgentPOs').textContent = '2';
        }

        // Update shipment tracking
        function updateShipmentMetrics() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            // Example dynamic updates (extend as needed)
            document.getElementById('lastWeighing').textContent = '3 min ago';
            document.getElementById('todayShipped').textContent = '782 MT';
            // document.getElementById('monthlyShipped').textContent = '13,420 MT'; // optionally update
        }

        // Auto-update sync time
        function updateSyncTime() {
            const now = new Date();
            const minutes = Math.floor(Math.random() * 5) + 1;
            document.getElementById('lastSync').textContent = `${minutes} min ago`;
        }

        setInterval(updateSyncTime, 60000);

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Local Supply Chain Dashboard initialized');
            console.log('Jason Neo - SAP integration active');
            if (typeof updateShipmentMetrics === 'function') {
                updateShipmentMetrics();
            }
        });
    </script>
</body>
</html>