<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="https://onsenix12.github.io/evonik-dashboard/">
    <title>Local Supply Chain Dashboard - Jason Neo</title>
    <link rel="stylesheet" href="shared-styles-new.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* Page-specific styles for local-supply-chain.html */
        .header {
            background: linear-gradient(135deg, var(--supply-orange) 0%, #C2410C 100%);
        }

        .back-btn:hover {
            color: var(--supply-orange);
        }

        .materials-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .material-card {
            background: var(--bg-gray);
            padding: 1.5rem;
            border-radius: 8px;
            border: 2px solid var(--border-gray);
            transition: border-color 0.3s;
        }

        .material-card:hover {
            border-color: var(--supply-orange);
        }

        .material-card.critical {
            border-color: var(--alert-red);
            background: rgba(220, 38, 38, 0.05);
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .material-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .material-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-adequate {
            background: rgba(22, 163, 74, 0.1);
            color: var(--success-green);
        }

        .status-monitor {
            background: rgba(234, 88, 12, 0.1);
            color: var(--warning-orange);
        }

        .status-critical {
            background: rgba(220, 38, 38, 0.1);
            color: var(--alert-red);
        }

        .material-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .material-metric-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .material-metric-value {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .procurement-table tr:hover {
            background: rgba(234, 88, 12, 0.05);
        }

        .sync-detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .sync-module {
            padding: 1rem;
            background: var(--bg-gray);
            border-radius: 8px;
            border-left: 4px solid var(--success-green);
        }

        .sync-module.warning {
            border-left-color: var(--warning-orange);
        }

        .sync-module-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .sync-time {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        @media (max-width: 1024px) {
            .materials-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .sync-detail-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .materials-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Chart Container Styles */
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 1rem;
        }

        .chart-container.tall {
            height: 350px;
        }

        .chart-container.small {
            height: 250px;
        }

        .upload-section {
            background: var(--bg-gray);
            padding: 1.5rem;
            border-radius: 8px;
            border: 2px dashed var(--border-gray);
            margin-top: 1rem;
            transition: border-color 0.3s;
        }

        .upload-section:hover {
            border-color: var(--supply-orange);
        }

        .upload-section.dragover {
            border-color: var(--supply-orange);
            background: rgba(234, 88, 12, 0.05);
        }

        .upload-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .upload-title {
            font-weight: 600;
            color: var(--text-dark);
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .upload-btn {
            background: var(--supply-orange);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .upload-btn:hover {
            background: #C2410C;
        }

        .upload-info {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .upload-status {
            margin-top: 0.75rem;
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 0.9rem;
            display: none;
        }

        .upload-status.success {
            background: rgba(22, 163, 74, 0.1);
            color: var(--success-green);
            border: 1px solid rgba(22, 163, 74, 0.2);
            display: block;
        }

        .upload-status.error {
            background: rgba(220, 38, 38, 0.1);
            color: var(--alert-red);
            border: 1px solid rgba(220, 38, 38, 0.2);
            display: block;
        }

        .chart-wrapper {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border-gray);
            margin-top: 1rem;
        }

        .chart-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .chart-subtitle {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .benchmark-label {
            font-size: 0.75rem;
            color: var(--text-light);
            font-style: italic;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">üìä Evonik</div>
                <div>
                    <div style="font-size: 1.2rem; font-weight: 600;">Local Supply Chain Dashboard</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Inventory & Procurement Management - Singapore</div>
                </div>
            </div>
            <div class="user-info">
                <div style="font-size: 1.1rem; font-weight: 600;">Jason Neo</div>
                <div style="font-size: 0.9rem; opacity: 0.9;">Local Supply Chain Manager</div>
            </div>
        </div>
    </header>

    <nav class="back-nav">
        <div class="nav-content">
            <a href="index-new.html" class="back-btn">‚Üê Back to Coordination Hub</a>
            <a href="optimizer-new.html" class="optimizer-btn">
                AI Decision Support
            </a>
            <div class="breadcrumb">Local Supply Chain</div>
        </div>
    </nav>

    <div class="alerts-banner" id="alertsBanner">
        <strong>SUPPLY CHAIN ALERT:</strong> <span id="alertMessage"></span>
    </div>

    <main class="main-content">
        <!-- SAP Integration Status -->
        <h2 class="section-title">SAP Integration Status</h2>
        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Sync Health</div>
                    <div class="card-status status-operational" id="syncHealth">Active</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Last Sync</div>
                    <div class="metric-value" id="lastSync">2 min ago</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Next Sync</div>
                    <div class="metric-value">3 min</div>
                    <div class="metric-subtext">Auto-sync every 5 minutes</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Data Freshness</div>
                    <div class="card-status status-operational">Current</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Production Data</div>
                    <div class="metric-value" style="font-size: 1rem;" id="prodDataTime">2 min ago</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Inventory Data</div>
                    <div class="metric-value" style="font-size: 1rem;" id="invDataTime">2 min ago</div>
                </div>
                <div class="metric">
                    <div class="metric-label">PO Data</div>
                    <div class="metric-value" style="font-size: 1rem;" id="poDataTime">5 min ago</div>
                </div>
                <div class="upload-section" id="uploadSection">
                    <div class="upload-header">
                        <div class="upload-title">Update Data from File</div>
                        <div class="file-input-wrapper">
                            <input type="file" id="dataFileInput" class="file-input" accept=".xlsx,.xls,.csv" />
                            <label for="dataFileInput" class="upload-btn">
                                üìÅ Upload Excel/CSV
                            </label>
                        </div>
                    </div>
                    <div class="upload-info">
                        Upload updated data from Excel (.xlsx, .xls) or CSV files to refresh dashboard metrics
                    </div>
                    <div class="upload-status" id="uploadStatus"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Sync Errors</div>
                    <div class="card-status status-operational" id="syncErrors">None</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Last 24 Hours</div>
                    <div class="metric-value">0</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Last Failed Sync</div>
                    <div class="metric-value" style="font-size: 1rem;">Oct 18</div>
                    <div class="metric-subtext">MM module timeout (resolved)</div>
                </div>
            </div>
        </div>

        <!-- Procurement Overview -->
        <h2 class="section-title">Procurement Pipeline</h2>
        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Open Purchase Orders</div>
                    <div class="card-status status-operational">12 active</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Total Value</div>
                    <div class="metric-value" id="totalPOValue">$2.8M</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Urgent Items</div>
                    <div class="metric-value" style="color: var(--warning-orange);" id="urgentPOs">2</div>
                    <div class="metric-subtext">Require confirmation</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Deliveries This Week</div>
                    <div class="card-status status-operational">5 expected</div>
                </div>
                <div class="metric">
                    <div class="metric-label">On Schedule</div>
                    <div class="metric-value">4</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Delayed</div>
                    <div class="metric-value" style="color: var(--warning-orange);" id="delayedDeliveries">1</div>
                    <div class="metric-subtext">Methanol - 2 days late</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Supplier Performance</div>
                    <div class="card-status status-operational">Good</div>
                </div>
                <div class="metric">
                    <div class="metric-label">On-Time Delivery Rate</div>
                    <div class="metric-value" id="onTimeRate">94%</div>
                    <div class="metric-subtext">Last 30 days</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Quality Issues</div>
                    <div class="metric-value">0</div>
                </div>
            </div>
        </div>

        <!-- Procurement Value Trend Chart -->
        <div class="chart-wrapper">
            <div class="chart-title">Procurement Value Trend (Last 12 Months)</div>
            <div class="chart-subtitle">Monthly PO Value vs Budget Benchmark ($M)</div>
            <div class="chart-container">
                <canvas id="procurementTrendChart"></canvas>
            </div>
            <div class="benchmark-label">üîµ Benchmark: $2.5M monthly budget</div>
        </div>

        <!-- Supplier Performance Chart -->
        <div class="chart-wrapper">
            <div class="chart-title">Supplier On-Time Delivery Rate (Last 6 Months)</div>
            <div class="chart-subtitle">Performance by Supplier (%)</div>
            <div class="chart-container">
                <canvas id="supplierPerformanceChart"></canvas>
            </div>
            <div class="benchmark-label">üîµ Benchmark: 95% target on-time delivery rate</div>
        </div>
<!-- Products Shipped Out (OAS Weighing System) -->
<h2 class="section-title">Products Shipped Out (OAS Tracking)</h2>
<p class="section-note" style="color: var(--text-light); font-size: 0.9rem; margin: -0.5rem 0 1rem 0;">
    ‚ÑπÔ∏è Finished product inventory is managed by <strong>Katoen Natie</strong> (third-party logistics partner). 
    This section tracks products leaving the Singapore facility (OAS weighing machine).
</p>
<div class="dashboard-grid">
    <div class="card">
        <div class="card-header">
            <div class="card-title">Today's Shipments</div>
            <div class="card-status status-operational" id="shipmentStatus">On Track</div>
        </div>
        <div class="metric">
            <div class="metric-label">Shipped Today</div>
            <div class="metric-value" id="todayShipped">782 MT</div>
            <div class="metric-subtext">12 truck loads</div>
        </div>
        <div class="metric">
            <div class="metric-label">Target Daily Output</div>
            <div class="metric-value">965 MT/day</div>
        </div>
        <div class="metric">
            <div class="metric-label">Achievement</div>
            <div class="metric-value" style="font-size: 1rem; color: var(--success-green);">81%</div>
            <div class="metric-subtext">As of 2:30 PM</div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">Monthly Cumulative</div>
            <div class="card-status status-operational">Ahead of Target</div>
        </div>
        <div class="metric">
            <div class="metric-label">Shipped This Month</div>
            <div class="metric-value" id="monthlyShipped">13,420 MT</div>
            <div class="metric-subtext">Oct 1 - Oct 15</div>
        </div>
        <div class="metric">
            <div class="metric-label">Monthly Target</div>
            <div class="metric-value">28,950 MT</div>
        </div>
        <div class="metric">
            <div class="metric-label">Progress</div>
            <div class="metric-value" style="font-size: 1rem;">46.4%</div>
            <div class="metric-subtext">15 days elapsed (48.4%)</div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">OAS Integration</div>
            <div class="card-status status-operational" id="oasStatus">Connected</div>
        </div>
        <div class="metric">
            <div class="metric-label">Last Weighing</div>
            <div class="metric-value" style="font-size: 1rem;" id="lastWeighing">3 min ago</div>
            <div class="metric-subtext">Truck #SG-4829 | 68 MT</div>
        </div>
        <div class="metric">
            <div class="metric-label">System Status</div>
            <div class="metric-value" style="font-size: 1rem; color: var(--success-green);">Online</div>
        </div>
        <div class="metric">
            <div class="metric-label">Data Sync</div>
            <div class="metric-value" style="font-size: 1rem;">Real-time</div>
            <div class="metric-subtext">Auto-sync enabled</div>
        </div>
    </div>
</div>

<!-- Daily Shipments Trend Chart -->
<div class="chart-wrapper">
    <div class="chart-title">Daily Shipments Trend (Last 14 Days)</div>
    <div class="chart-subtitle">Actual vs Target Daily Output (965 MT/day benchmark)</div>
    <div class="chart-container">
        <canvas id="dailyShipmentsChart"></canvas>
    </div>
    <div class="benchmark-label">üîµ Benchmark: 965 MT/day target</div>
</div>

<!-- Monthly Progress Chart -->
<div class="chart-wrapper">
    <div class="chart-title">Monthly Cumulative Progress</div>
    <div class="chart-subtitle">Shipped vs Target by Week (MT)</div>
    <div class="chart-container">
        <canvas id="monthlyProgressChart"></canvas>
    </div>
    <div class="benchmark-label">üü¢ Benchmark: 28,950 MT monthly target</div>
</div>

<!-- Recent Shipments Table -->
<div class="section-panel">
    <h3 class="section-title">Recent Shipments (Last 24 Hours)</h3>
    <table class="procurement-table">
        <thead>
            <tr>
                <th>Time</th>
                <th>Truck ID</th>
                <th>Weight (MT)</th>
                <th>Destination</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="shipmentsTableBody">
            <tr>
                <td>14:27</td>
                <td>SG-4829</td>
                <td>68 MT</td>
                <td>Katoen Natie Warehouse</td>
                <td><span class="po-status po-delivered" style="background: rgba(22, 163, 74, 0.1); color: var(--success-green);">Delivered</span></td>
            </tr>
            <tr>
                <td>13:15</td>
                <td>SG-4801</td>
                <td>65 MT</td>
                <td>Katoen Natie Warehouse</td>
                <td><span class="po-status po-delivered" style="background: rgba(22, 163, 74, 0.1); color: var(--success-green);">Delivered</span></td>
            </tr>
            <tr>
                <td>11:42</td>
                <td>SG-4788</td>
                <td>67 MT</td>
                <td>Katoen Natie Warehouse</td>
                <td><span class="po-status po-delivered" style="background: rgba(22, 163, 74, 0.1); color: var(--success-green);">Delivered</span></td>
            </tr>
            <tr>
                <td>10:18</td>
                <td>SG-4773</td>
                <td>66 MT</td>
                <td>Katoen Natie Warehouse</td>
                <td><span class="po-status po-delivered" style="background: rgba(22, 163, 74, 0.1); color: var(--success-green);">Delivered</span></td>
            </tr>
            <tr>
                <td>08:55</td>
                <td>SG-4762</td>
                <td>64 MT</td>
                <td>Katoen Natie Warehouse</td>
                <td><span class="po-status po-delivered" style="background: rgba(22, 163, 74, 0.1); color: var(--success-green);">Delivered</span></td>
            </tr>
        </tbody>
    </table>
</div>
        <!-- Raw Materials -->
        <div class="section-panel">
            <h3 class="section-title">Raw Materials Status</h3>
            <div class="materials-grid">
                <div class="material-card">
                    <div class="material-header">
                        <div class="material-name">Hydrogen (H2)</div>
                        <div class="material-status status-adequate">Adequate</div>
                    </div>
                    <div class="material-metrics">
                        <div>
                            <div class="material-metric-label">Current Stock</div>
                            <div class="material-metric-value" id="h2Stock">4,800 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Consumption</div>
                            <div class="material-metric-value">85 MT/day</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Reorder Point</div>
                            <div class="material-metric-value">2,500 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Lead Time</div>
                            <div class="material-metric-value">14 days</div>
                        </div>
                    </div>
                    <div class="chart-container small" style="margin-top: 1rem;">
                        <canvas id="h2StockChart"></canvas>
                    </div>
                </div>

                <div class="material-card">
                    <div class="material-header">
                        <div class="material-name">MMP</div>
                        <div class="material-status status-adequate">Adequate</div>
                    </div>
                    <div class="material-metrics">
                        <div>
                            <div class="material-metric-label">Current Stock</div>
                            <div class="material-metric-value" id="mmpStock">1,850 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Consumption</div>
                            <div class="material-metric-value">42 MT/day</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Reorder Point</div>
                            <div class="material-metric-value">1,200 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Lead Time</div>
                            <div class="material-metric-value">21 days</div>
                        </div>
                    </div>
                    <div class="chart-container small" style="margin-top: 1rem;">
                        <canvas id="mmpStockChart"></canvas>
                    </div>
                </div>

                <div class="material-card" id="methanolCard">
                    <div class="material-header">
                        <div class="material-name">Methanol (CH3OH)</div>
                        <div class="material-status status-monitor" id="methanolStatus">Monitor</div>
                    </div>
                    <div class="material-metrics">
                        <div>
                            <div class="material-metric-label">Current Stock</div>
                            <div class="material-metric-value" id="methanolStock">980 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Consumption</div>
                            <div class="material-metric-value">38 MT/day</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Reorder Point</div>
                            <div class="material-metric-value">800 MT</div>
                        </div>
                        <div>
                            <div class="material-metric-label">Lead Time</div>
                            <div class="material-metric-value">18 days</div>
                        </div>
                    </div>
                    <div class="chart-container small" style="margin-top: 1rem;">
                        <canvas id="methanolStockChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Raw Materials Inventory Trend -->
        <div class="chart-wrapper">
            <div class="chart-title">Raw Materials Inventory Trend (Last 30 Days)</div>
            <div class="chart-subtitle">Stock levels vs Reorder Points (MT)</div>
            <div class="chart-container tall">
                <canvas id="materialsInventoryChart"></canvas>
            </div>
            <div class="benchmark-label">üî¥ Reorder Point benchmarks: H2 (2,500 MT), MMP (1,200 MT), Methanol (800 MT)</div>
        </div>

        <!-- Active Purchase Orders -->
        <div class="section-panel">
            <h3 class="section-title">Active Purchase Orders</h3>
            <table class="procurement-table">
                <thead>
                    <tr>
                        <th>PO Number</th>
                        <th>Material</th>
                        <th>Quantity</th>
                        <th>Supplier</th>
                        <th>Expected Delivery</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="poTableBody">
                    <tr>
                        <td>PO-2847</td>
                        <td>Hydrogen</td>
                        <td>1,500 MT</td>
                        <td>Supplier A</td>
                        <td>Oct 28, 2025</td>
                        <td><span class="po-status po-transit">In Transit</span></td>
                    </tr>
                    <tr>
                        <td>PO-2848</td>
                        <td>Methanol</td>
                        <td>850 MT</td>
                        <td>Supplier B</td>
                        <td>Oct 26, 2025</td>
                        <td><span class="po-status po-urgent">Delayed 2d</span></td>
                    </tr>
                    <tr>
                        <td>PO-2849</td>
                        <td>MMP</td>
                        <td>600 MT</td>
                        <td>Supplier C</td>
                        <td>Nov 2, 2025</td>
                        <td><span class="po-status po-open">Confirmed</span></td>
                    </tr>
                    <tr>
                        <td>PO-2850</td>
                        <td>Hydrogen</td>
                        <td>2,000 MT</td>
                        <td>Supplier A</td>
                        <td>Nov 5, 2025</td>
                        <td><span class="po-status po-open">Awaiting Confirmation</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <script>
        // Dashboard Data Store
        const dashboardData = {
            dailyShipments: [820, 850, 790, 865, 910, 880, 782, 795, 810, 845, 870, 890, 825, 850],
            monthlyProgress: [7240, 13420, 19580, 25740],
            monthlyTarget: [7240, 14480, 21720, 28960],
            procurementTrend: [2.1, 2.3, 2.0, 2.5, 2.7, 2.4, 2.6, 2.8, 2.3, 2.6, 2.5, 2.8],
            supplierPerformance: {
                'Supplier A': [96, 97, 95, 98, 96, 97],
                'Supplier B': [92, 93, 94, 93, 95, 94],
                'Supplier C': [90, 91, 92, 93, 94, 95]
            },
            materialsInventory: {
                h2: Array.from({length: 30}, () => 4800 + Math.random() * 200),
                mmp: Array.from({length: 30}, () => 1850 + Math.random() * 100),
                methanol: Array.from({length: 30}, () => 980 - Math.random() * 50)
            },
            h2Stock: 4800,
            mmpStock: 1850,
            methanolStock: 980,
            todayShipped: 782,
            monthlyShipped: 13420,
            totalPOValue: 2.8,
            onTimeRate: 94
        };

        // Chart instances
        let dailyShipmentsChart, monthlyProgressChart, procurementTrendChart, 
            supplierPerformanceChart, materialsInventoryChart, h2StockChart, 
            mmpStockChart, methanolStockChart;

        // Initialize Charts
        function initCharts() {
            // Daily Shipments Trend Chart (Line Chart)
            const dailyCtx = document.getElementById('dailyShipmentsChart');
            if (dailyCtx) {
                dailyShipmentsChart = new Chart(dailyCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 14}, (_, i) => {
                            const date = new Date();
                            date.setDate(date.getDate() - (13 - i));
                            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                        }),
                        datasets: [{
                            label: 'Actual Shipped (MT)',
                            data: dashboardData.dailyShipments,
                            borderColor: '#EA580C',
                            backgroundColor: 'rgba(234, 88, 12, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }, {
                            label: 'Target Benchmark (965 MT/day)',
                            data: Array(14).fill(965),
                            borderColor: '#2563EB',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: { mode: 'index', intersect: false }
                        },
                        scales: {
                            y: { beginAtZero: false, title: { display: true, text: 'Metric Tons (MT)' } }
                        }
                    }
                });
            }

            // Monthly Progress Chart (Bar Chart)
            const monthlyCtx = document.getElementById('monthlyProgressChart');
            if (monthlyCtx) {
                monthlyProgressChart = new Chart(monthlyCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Shipped (MT)',
                            data: dashboardData.monthlyProgress,
                            backgroundColor: 'rgba(234, 88, 12, 0.8)',
                            borderColor: '#EA580C',
                            borderWidth: 1
                        }, {
                            label: 'Target (MT)',
                            data: dashboardData.monthlyTarget,
                            type: 'line',
                            borderColor: '#16A34A',
                            borderWidth: 3,
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 5,
                            pointBackgroundColor: '#16A34A'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' }
                        },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Metric Tons (MT)' } }
                        }
                    }
                });
            }

            // Procurement Trend Chart (Area Chart)
            const procCtx = document.getElementById('procurementTrendChart');
            if (procCtx) {
                procurementTrendChart = new Chart(procCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [{
                            label: 'Monthly PO Value ($M)',
                            data: dashboardData.procurementTrend,
                            borderColor: '#EA580C',
                            backgroundColor: 'rgba(234, 88, 12, 0.2)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }, {
                            label: 'Budget Benchmark ($2.5M)',
                            data: Array(12).fill(2.5),
                            borderColor: '#2563EB',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' }
                        },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Value ($M)' } }
                        }
                    }
                });
            }

            // Supplier Performance Chart (Line Chart)
            const suppCtx = document.getElementById('supplierPerformanceChart');
            if (suppCtx) {
                const months = ['May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'];
                supplierPerformanceChart = new Chart(suppCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Supplier A',
                                data: dashboardData.supplierPerformance['Supplier A'],
                                borderColor: '#16A34A',
                                backgroundColor: 'rgba(22, 163, 74, 0.1)',
                                borderWidth: 2,
                                tension: 0.4
                            },
                            {
                                label: 'Supplier B',
                                data: dashboardData.supplierPerformance['Supplier B'],
                                borderColor: '#EA580C',
                                backgroundColor: 'rgba(234, 88, 12, 0.1)',
                                borderWidth: 2,
                                tension: 0.4
                            },
                            {
                                label: 'Supplier C',
                                data: dashboardData.supplierPerformance['Supplier C'],
                                borderColor: '#2563EB',
                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                borderWidth: 2,
                                tension: 0.4
                            },
                            {
                                label: 'Target Benchmark (95%)',
                                data: Array(6).fill(95),
                                borderColor: '#6366F1',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                fill: false,
                                pointRadius: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' }
                        },
                        scales: {
                            y: { 
                                beginAtZero: false,
                                min: 85,
                                max: 100,
                                title: { display: true, text: 'On-Time Delivery Rate (%)' }
                            }
                        }
                    }
                });
            }

            // Materials Inventory Trend Chart
            const matInvCtx = document.getElementById('materialsInventoryChart');
            if (matInvCtx) {
                const days = Array.from({length: 30}, (_, i) => {
                    const date = new Date();
                    date.setDate(date.getDate() - (29 - i));
                    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                });
                materialsInventoryChart = new Chart(matInvCtx, {
                    type: 'line',
                    data: {
                        labels: days,
                        datasets: [
                            {
                                label: 'Hydrogen (H2)',
                                data: dashboardData.materialsInventory.h2,
                                borderColor: '#16A34A',
                                backgroundColor: 'rgba(22, 163, 74, 0.1)',
                                borderWidth: 2,
                                fill: true
                            },
                            {
                                label: 'MMP',
                                data: dashboardData.materialsInventory.mmp,
                                borderColor: '#2563EB',
                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                borderWidth: 2,
                                fill: true
                            },
                            {
                                label: 'Methanol',
                                data: dashboardData.materialsInventory.methanol,
                                borderColor: '#EA580C',
                                backgroundColor: 'rgba(234, 88, 12, 0.1)',
                                borderWidth: 2,
                                fill: true
                            },
                            {
                                label: 'H2 Reorder Point',
                                data: Array(30).fill(2500),
                                borderColor: '#DC2626',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                pointRadius: 0
                            },
                            {
                                label: 'MMP Reorder Point',
                                data: Array(30).fill(1200),
                                borderColor: '#DC2626',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                pointRadius: 0
                            },
                            {
                                label: 'Methanol Reorder Point',
                                data: Array(30).fill(800),
                                borderColor: '#DC2626',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                pointRadius: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' }
                        },
                        scales: {
                            y: { beginAtZero: false, title: { display: true, text: 'Stock (MT)' } }
                        }
                    }
                });
            }

            // Material Stock Charts (Gauge-style Bar Charts)
            initMaterialStockCharts();
        }

        function initMaterialStockCharts() {
            // H2 Stock Chart
            const h2Ctx = document.getElementById('h2StockChart');
            if (h2Ctx) {
                h2StockChart = new Chart(h2Ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Current', 'Reorder Point', 'Max Capacity'],
                        datasets: [{
                            label: 'Stock Level (MT)',
                            data: [dashboardData.h2Stock, 2500, 6000],
                            backgroundColor: [
                                dashboardData.h2Stock > 2500 ? 'rgba(22, 163, 74, 0.8)' : 'rgba(234, 88, 12, 0.8)',
                                'rgba(220, 38, 38, 0.8)',
                                'rgba(107, 114, 128, 0.3)'
                            ],
                            borderColor: [
                                dashboardData.h2Stock > 2500 ? '#16A34A' : '#EA580C',
                                '#DC2626',
                                '#6B7280'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.parsed.y.toLocaleString()} MT` } }
                        },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'MT' } }
                        }
                    }
                });
            }

            // MMP Stock Chart
            const mmpCtx = document.getElementById('mmpStockChart');
            if (mmpCtx) {
                mmpStockChart = new Chart(mmpCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Current', 'Reorder Point', 'Max Capacity'],
                        datasets: [{
                            label: 'Stock Level (MT)',
                            data: [dashboardData.mmpStock, 1200, 3000],
                            backgroundColor: [
                                dashboardData.mmpStock > 1200 ? 'rgba(22, 163, 74, 0.8)' : 'rgba(234, 88, 12, 0.8)',
                                'rgba(220, 38, 38, 0.8)',
                                'rgba(107, 114, 128, 0.3)'
                            ],
                            borderColor: [
                                dashboardData.mmpStock > 1200 ? '#16A34A' : '#EA580C',
                                '#DC2626',
                                '#6B7280'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.parsed.y.toLocaleString()} MT` } }
                        },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'MT' } }
                        }
                    }
                });
            }

            // Methanol Stock Chart
            const methCtx = document.getElementById('methanolStockChart');
            if (methCtx) {
                methanolStockChart = new Chart(methCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Current', 'Reorder Point', 'Max Capacity'],
                        datasets: [{
                            label: 'Stock Level (MT)',
                            data: [dashboardData.methanolStock, 800, 2000],
                            backgroundColor: [
                                dashboardData.methanolStock > 800 ? 'rgba(234, 88, 12, 0.8)' : 'rgba(220, 38, 38, 0.8)',
                                'rgba(220, 38, 38, 0.8)',
                                'rgba(107, 114, 128, 0.3)'
                            ],
                            borderColor: [
                                dashboardData.methanolStock > 800 ? '#EA580C' : '#DC2626',
                                '#DC2626',
                                '#6B7280'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.parsed.y.toLocaleString()} MT` } }
                        },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'MT' } }
                        }
                    }
                });
            }
        }

        // File Upload Functionality
        function setupFileUpload() {
            const fileInput = document.getElementById('dataFileInput');
            const uploadSection = document.getElementById('uploadSection');
            const uploadStatus = document.getElementById('uploadStatus');

            // Drag and drop
            uploadSection.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadSection.classList.add('dragover');
            });

            uploadSection.addEventListener('dragleave', () => {
                uploadSection.classList.remove('dragover');
            });

            uploadSection.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadSection.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            });

            // File input change
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        function handleFileUpload(file) {
            const uploadStatus = document.getElementById('uploadStatus');
            const fileName = file.name.toLowerCase();

            uploadStatus.className = 'upload-status';
            uploadStatus.textContent = 'Processing file...';

            if (fileName.endsWith('.csv')) {
                parseCSV(file);
            } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                parseExcel(file);
            } else {
                showUploadStatus('error', 'Invalid file format. Please upload CSV or Excel files.');
            }
        }

        function parseCSV(file) {
            Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    if (results.errors.length > 0) {
                        showUploadStatus('error', 'Error parsing CSV: ' + results.errors[0].message);
                        return;
                    }
                    updateDataFromParsed(results.data);
                    showUploadStatus('success', `Successfully updated data from ${file.name}`);
                    updateDataFreshness();
                },
                error: function(error) {
                    showUploadStatus('error', 'Error reading CSV file: ' + error.message);
                }
            });
        }

        function parseExcel(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    updateDataFromParsed(jsonData);
                    showUploadStatus('success', `Successfully updated data from ${file.name}`);
                    updateDataFreshness();
                } catch (error) {
                    showUploadStatus('error', 'Error parsing Excel file: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function updateDataFromParsed(data) {
            // Example data structure expected:
            // Can handle columns like: Date, ShippedMT, H2Stock, MMPStock, MethanolStock, POValue, OnTimeRate, etc.
            if (!data || data.length === 0) return;

            // Update based on detected columns
            const firstRow = data[0];
            const keys = Object.keys(firstRow);

            data.forEach(row => {
                // Update shipment data
                if (hasColumn(keys, ['shipped', 'shipment', 'mt'])) {
                    const shipped = parseFloat(row[findColumn(keys, ['shipped', 'shipment', 'mt'])]);
                    if (!isNaN(shipped) && shipped > 0) {
                        dashboardData.todayShipped = shipped;
                        dashboardData.dailyShipments[dashboardData.dailyShipments.length - 1] = shipped;
                    }
                }

                // Update material stocks
                if (hasColumn(keys, ['h2', 'hydrogen'])) {
                    const h2 = parseFloat(row[findColumn(keys, ['h2', 'hydrogen'])]);
                    if (!isNaN(h2) && h2 > 0) {
                        dashboardData.h2Stock = h2;
                        dashboardData.materialsInventory.h2[dashboardData.materialsInventory.h2.length - 1] = h2;
                    }
                }

                if (hasColumn(keys, ['mmp'])) {
                    const mmp = parseFloat(row[findColumn(keys, ['mmp'])]);
                    if (!isNaN(mmp) && mmp > 0) {
                        dashboardData.mmpStock = mmp;
                        dashboardData.materialsInventory.mmp[dashboardData.materialsInventory.mmp.length - 1] = mmp;
                    }
                }

                if (hasColumn(keys, ['methanol', 'ch3oh'])) {
                    const methanol = parseFloat(row[findColumn(keys, ['methanol', 'ch3oh'])]);
                    if (!isNaN(methanol) && methanol > 0) {
                        dashboardData.methanolStock = methanol;
                        dashboardData.materialsInventory.methanol[dashboardData.materialsInventory.methanol.length - 1] = methanol;
                    }
                }

                // Update PO value
                if (hasColumn(keys, ['po', 'purchase', 'value'])) {
                    const poValue = parseFloat(row[findColumn(keys, ['po', 'purchase', 'value'])]);
                    if (!isNaN(poValue) && poValue > 0) {
                        dashboardData.totalPOValue = poValue;
                    }
                }

                // Update on-time rate
                if (hasColumn(keys, ['ontime', 'delivery', 'rate'])) {
                    const rate = parseFloat(row[findColumn(keys, ['ontime', 'delivery', 'rate'])]);
                    if (!isNaN(rate) && rate >= 0 && rate <= 100) {
                        dashboardData.onTimeRate = rate;
                    }
                }
            });

            // Refresh all UI elements and charts
            updateDashboardUI();
            refreshCharts();
        }

        function hasColumn(keys, patterns) {
            return keys.some(key => 
                patterns.some(pattern => key.toLowerCase().includes(pattern))
            );
        }

        function findColumn(keys, patterns) {
            return keys.find(key => 
                patterns.some(pattern => key.toLowerCase().includes(pattern))
            );
        }

        function updateDashboardUI() {
            document.getElementById('todayShipped').textContent = `${dashboardData.todayShipped.toLocaleString()} MT`;
            document.getElementById('h2Stock').textContent = `${dashboardData.h2Stock.toLocaleString()} MT`;
            document.getElementById('mmpStock').textContent = `${dashboardData.mmpStock.toLocaleString()} MT`;
            document.getElementById('methanolStock').textContent = `${dashboardData.methanolStock.toLocaleString()} MT`;
            document.getElementById('totalPOValue').textContent = `$${dashboardData.totalPOValue.toFixed(1)}M`;
            document.getElementById('onTimeRate').textContent = `${dashboardData.onTimeRate}%`;
        }

        function refreshCharts() {
            if (dailyShipmentsChart) {
                dailyShipmentsChart.data.datasets[0].data = dashboardData.dailyShipments;
                dailyShipmentsChart.update();
            }
            if (h2StockChart) {
                h2StockChart.data.datasets[0].data[0] = dashboardData.h2Stock;
                h2StockChart.data.datasets[0].backgroundColor[0] = dashboardData.h2Stock > 2500 ? 'rgba(22, 163, 74, 0.8)' : 'rgba(234, 88, 12, 0.8)';
                h2StockChart.data.datasets[0].borderColor[0] = dashboardData.h2Stock > 2500 ? '#16A34A' : '#EA580C';
                h2StockChart.update();
            }
            if (mmpStockChart) {
                mmpStockChart.data.datasets[0].data[0] = dashboardData.mmpStock;
                mmpStockChart.data.datasets[0].backgroundColor[0] = dashboardData.mmpStock > 1200 ? 'rgba(22, 163, 74, 0.8)' : 'rgba(234, 88, 12, 0.8)';
                mmpStockChart.data.datasets[0].borderColor[0] = dashboardData.mmpStock > 1200 ? '#16A34A' : '#EA580C';
                mmpStockChart.update();
            }
            if (methanolStockChart) {
                methanolStockChart.data.datasets[0].data[0] = dashboardData.methanolStock;
                methanolStockChart.data.datasets[0].backgroundColor[0] = dashboardData.methanolStock > 800 ? 'rgba(234, 88, 12, 0.8)' : 'rgba(220, 38, 38, 0.8)';
                methanolStockChart.data.datasets[0].borderColor[0] = dashboardData.methanolStock > 800 ? '#EA580C' : '#DC2626';
                methanolStockChart.update();
            }
            if (materialsInventoryChart) {
                materialsInventoryChart.data.datasets[0].data = dashboardData.materialsInventory.h2;
                materialsInventoryChart.data.datasets[1].data = dashboardData.materialsInventory.mmp;
                materialsInventoryChart.data.datasets[2].data = dashboardData.materialsInventory.methanol;
                materialsInventoryChart.update();
            }
            if (procurementTrendChart) {
                procurementTrendChart.update();
            }
            if (supplierPerformanceChart) {
                supplierPerformanceChart.update();
            }
        }

        function showUploadStatus(type, message) {
            const uploadStatus = document.getElementById('uploadStatus');
            uploadStatus.className = `upload-status ${type}`;
            uploadStatus.textContent = message;
            setTimeout(() => {
                if (type === 'success') {
                    uploadStatus.style.display = 'none';
                }
            }, 5000);
        }

        function updateDataFreshness() {
            const now = new Date();
            document.getElementById('prodDataTime').textContent = 'Just now';
            document.getElementById('invDataTime').textContent = 'Just now';
            document.getElementById('poDataTime').textContent = 'Just now';
        }

        // Listen for coordination events
        window.addEventListener('storage', function(e) {
            if (e.key === 'evonik_coordination_event') {
                const eventData = JSON.parse(e.newValue);
                handleCoordinationEvent(eventData);
            }
        });

        function handleCoordinationEvent(event) {
            switch(event.type) {
                case 'equipment_failure':
                    showAlert('ME6 shutdown detected - Monitor tank depletion rate');
                    updateShipmentMetrics();
                    break;
                case 'supply_chain_adjustment':
                    showAlert('Methanol shipment delayed - Alternative sourcing required');
                    updateMethanolDelay();
                    break;
                case 'reset':
                    resetDashboard();
                    break;
            }
        }

        function showAlert(message) {
            const banner = document.getElementById('alertsBanner');
            document.getElementById('alertMessage').textContent = message;
            banner.classList.add('show');
            setTimeout(() => banner.classList.remove('show'), 8000);
        }

        function updateMethanolDelay() {
            const methanolCard = document.getElementById('methanolCard');
            methanolCard.classList.add('critical');
            dashboardData.methanolStock = 780;
            document.getElementById('methanolStock').textContent = '780 MT';
            document.getElementById('methanolStatus').className = 'material-status status-critical';
            document.getElementById('methanolStatus').textContent = 'Critical';
            document.getElementById('delayedDeliveries').textContent = '1';
            document.getElementById('urgentPOs').textContent = '3';
            refreshCharts();
        }

        function resetDashboard() {
            document.getElementById('alertsBanner').classList.remove('show');
            document.getElementById('shipmentStatus').textContent = 'On Track';
            document.getElementById('lastWeighing').textContent = '3 min ago';
            dashboardData.todayShipped = 782;
            document.getElementById('todayShipped').textContent = '782 MT';
            
            const methanolCard = document.getElementById('methanolCard');
            methanolCard.classList.remove('critical');
            dashboardData.methanolStock = 980;
            document.getElementById('methanolStock').textContent = '980 MT';
            document.getElementById('methanolStatus').className = 'material-status status-monitor';
            document.getElementById('methanolStatus').textContent = 'Monitor';
            document.getElementById('delayedDeliveries').textContent = '1';
            document.getElementById('urgentPOs').textContent = '2';
            refreshCharts();
        }

        function updateShipmentMetrics() {
            document.getElementById('lastWeighing').textContent = '3 min ago';
            document.getElementById('todayShipped').textContent = `${dashboardData.todayShipped} MT`;
        }

        function updateSyncTime() {
            const now = new Date();
            const minutes = Math.floor(Math.random() * 5) + 1;
            document.getElementById('lastSync').textContent = `${minutes} min ago`;
        }

        setInterval(updateSyncTime, 60000);

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Local Supply Chain Dashboard initialized');
            console.log('Jason Neo - SAP integration active');
            initCharts();
            setupFileUpload();
            updateDashboardUI();
        });
    </script>
</body>
</html>